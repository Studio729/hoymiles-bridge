# Docker Compose - User's Original Format Enhanced
# This matches your existing setup with all new v0.12.0 features available

version: "3"

services:
  hoymiles_mqtt:
    container_name: "hoymiles_mqtt"
    build:
      context: .
      dockerfile: Dockerfile
    image: hoymiles_mqtt
    network_mode: host
    environment:
      # ===== Required Settings (Your Original Config) =====
      MQTT_BROKER: 192.168.1.31
      DTU_HOST: 192.168.1.194
      MICROINVERTER_TYPE: 'HM'
      QUERY_PERIOD: 300
      
      # ===== Optional Settings (New in v0.12.0) =====
      # Uncomment and modify as needed
      
      # MQTT Options
      # MQTT_PORT: 1883
      # MQTT_USER: your_user
      # MQTT_PASSWORD: your_password
      # MQTT_TLS: false
      
      # DTU Options  
      # DTU_PORT: 502
      # MODBUS_UNIT_ID: 1
      
      # Timing Options
      # TIMEZONE: America/New_York
      # RESET_HOUR: 23
      # EXPIRE_AFTER: 0
      
      # Persistence (survives restarts)
      # PERSISTENCE_ENABLED: true
      # DATABASE_PATH: /data/hoymiles-mqtt.db
      
      # Web Server / Health Monitoring
      # Access at http://your-ip:PORT/health
      # HEALTH_ENABLED: true
      # HEALTH_PORT: 8080              # Web server port (default: 8080)
      # METRICS_ENABLED: true
      
      # Logging
      # LOG_LEVEL: INFO
      # LOG_FORMAT: standard
      # LOG_TO_CONSOLE: true
    
    volumes:
      - ./data:/data
    
    labels:
      - "com.centurylinklabs.watchtower.enable=false"
    
    restart: unless-stopped

